<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORIX SCRIPTS | Evolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #8b5cf6; --bg: #06060a; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }

        /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
        #intro {
            position: fixed; inset: 0; background: #000; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease-out, visibility 1s;
        }
        .intro-text {
            font-size: 4rem; font-weight: 900; letter-spacing: -2px;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: intro-glow 2s ease-in-out infinite alternate;
        }
        @keyframes intro-glow { from { filter: drop-shadow(0 0 5px rgba(139, 92, 246, 0)); } to { filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.8)); } }

        /* –°—Ç–µ–∫–ª–æ –∏ –î–∏–∑–∞–π–Ω */
        .glass { background: rgba(15, 15, 25, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .card-anim { transition: 0.4s cubic-bezier(0.23, 1, 0.32, 1); }
        .card-anim:hover { transform: translateY(-5px) scale(1.01); border-color: var(--accent); }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        #sideMenu {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%;
            z-index: 100; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(20px);
            border-left: 1px solid rgba(139, 92, 246, 0.3);
        }
        #sideMenu.active { right: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); opacity: 0; visibility: hidden; transition: 0.3s; z-index: 90; }
        .overlay.active { opacity: 1; visibility: visible; }

        /* –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ */
        .fab {
            position: fixed; bottom: 30px; right: 30px; width: 64px; height: 64px;
            background: var(--accent); border-radius: 50%; z-index: 80;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
            cursor: pointer; transition: 0.3s;
        }
        .fab:hover { transform: rotate(90deg) scale(1.1); box-shadow: 0 0 30px rgba(139, 92, 246, 0.8); }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        pre { white-space: pre-wrap; word-break: break-all; }
    </style>
</head>
<body>

    <!-- –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
    <div id="intro">
        <div class="intro-text">MORIX</div>
        <div class="text-gray-500 tracking-[0.5em] text-xs mt-4 animate-pulse">LOADING ECOSYSTEM</div>
    </div>

    <!-- –§–û–ù–û–í–´–ï –°–í–ï–ß–ï–ù–ò–Ø -->
    <div class="fixed top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-900/20 blur-[120px] rounded-full"></div>
    <div class="fixed bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-blue-900/10 blur-[120px] rounded-full"></div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <nav class="glass sticky top-0 z-40 px-6 py-5">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-purple-600 rounded-xl flex items-center justify-center font-black">M</div>
                <h1 class="text-2xl font-black tracking-tighter uppercase">Morix <span class="text-purple-500">Scripts</span></h1>
            </div>
            <div class="relative group">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤..." 
                    class="bg-white/5 border border-white/10 px-6 py-2 rounded-full w-64 md:w-96 focus:border-purple-500 focus:w-[450px] transition-all outline-none">
            </div>
        </div>
    </nav>

    <!-- –õ–ï–ù–¢–ê -->
    <main class="max-w-4xl mx-auto px-6 py-10">
        <div id="scriptsList" class="grid grid-cols-1 gap-8">
            <!-- –°–∫—Ä–∏–ø—Ç—ã -->
        </div>
    </main>

    <!-- –ü–õ–ê–í–ê–Æ–©–ê–Ø –ö–ù–û–ü–ö–ê (–û–¢–ö–†–´–¢–¨ –ú–ï–ù–Æ) -->
    <div class="fab" onclick="toggleMenu(true)">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"></path>
        </svg>
    </div>

    <!-- –ó–ê–¢–ï–ú–ù–ï–ù–ò–ï -->
    <div class="overlay" onclick="toggleMenu(false)"></div>

    <!-- –ë–û–ö–û–í–û–ï –ú–ï–ù–Æ (–ú–ï–ù–Æ–®–ö–ê –°–û–ó–î–ê–ù–ò–Ø) -->
    <div id="sideMenu" class="p-8 flex flex-col">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-2xl font-bold">–ù–æ–≤—ã–π –ø–æ—Å—Ç</h2>
            <button onclick="toggleMenu(false)" class="text-gray-500 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <div class="space-y-5 overflow-y-auto pr-2">
            <div>
                <label class="text-xs text-gray-400 mb-2 block uppercase tracking-widest">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" id="title" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-purple-500">
            </div>
            <div>
                <label class="text-xs text-gray-400 mb-2 block uppercase tracking-widest">Lua –°–∫—Ä–∏–ø—Ç</label>
                <textarea id="code" class="w-full h-40 bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-purple-500 font-mono text-xs"></textarea>
            </div>
            <div>
                <label class="text-xs text-gray-400 mb-2 block uppercase tracking-widest">–ú–µ–¥–∏–∞ (5 —Å–µ–∫)</label>
                <input type="file" id="fileInput" accept="image/*,video/*" class="hidden">
                <div onclick="document.getElementById('fileInput').click()" id="preview" class="w-full h-40 border-2 border-dashed border-white/10 rounded-2xl flex items-center justify-center cursor-pointer overflow-hidden hover:border-purple-500 transition">
                    <span class="text-gray-500 text-sm">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª</span>
                </div>
            </div>
            <button id="submitBtn" onclick="submitPost()" class="w-full bg-purple-600 py-4 rounded-2xl font-bold hover:bg-purple-500 transition shadow-lg shadow-purple-500/20">
                –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
            </button>
        </div>
    </div>

    <script>
        const API_URL = "https://morix.onrender.com"; // <--- –ó–ê–ú–ï–ù–ò –≠–¢–û
        let mediaBase64 = null;
        let mediaType = null;

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        window.onload = () => {
            setTimeout(() => {
                const intro = document.getElementById('intro');
                intro.style.opacity = '0';
                setTimeout(() => intro.style.visibility = 'hidden', 1000);
            }, 2500);
            loadPosts();
        };

        function toggleMenu(show) {
            document.getElementById('sideMenu').classList.toggle('active', show);
            document.querySelector('.overlay').classList.toggle('active', show);
        }

        document.getElementById('fileInput').onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.type.startsWith('video')) {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = () => {
                    if (video.duration > 6) return alert("–í–∏–¥–µ–æ > 5 —Å–µ–∫!");
                    saveFile(file);
                };
                video.src = URL.createObjectURL(file);
            } else saveFile(file);
        };

        function saveFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                mediaBase64 = e.target.result;
                mediaType = file.type.startsWith('image') ? 'image' : 'video';
                const p = document.getElementById('preview');
                p.innerHTML = mediaType === 'image' 
                    ? `<img src="${mediaBase64}" class="w-full h-full object-cover">`
                    : `<video src="${mediaBase64}" muted autoplay loop class="w-full h-full object-cover"></video>`;
            };
            reader.readAsDataURL(file);
        }

        async function submitPost() {
            const title = document.getElementById('title').value;
            const code = document.getElementById('code').value;
            if(!title || !code) return alert("–ó–∞–ø–æ–ª–Ω–∏ –¥–∞–Ω–Ω—ã–µ!");

            const btn = document.getElementById('submitBtn');
            btn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞..."; btn.disabled = true;

            await fetch(`${API_URL}/scripts`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title, code, mediaData: mediaBase64, mediaType})
            });
            location.reload();
        }

        async function loadPosts(search = '') {
            const res = await fetch(`${API_URL}/scripts?search=${search}`);
            const data = await res.json();
            const list = document.getElementById('scriptsList');
            list.innerHTML = '';

            data.forEach((s, i) => {
                let media = s.mediaData ? (s.mediaType === 'image' 
                    ? `<img src="${s.mediaData}" class="w-full h-80 object-cover rounded-3xl mb-6 shadow-2xl">`
                    : `<video src="${s.mediaData}" autoplay muted loop class="w-full h-80 object-cover rounded-3xl mb-6 shadow-2xl"></video>`) : '';

                list.innerHTML += `
                    <div class="glass p-8 rounded-[2.5rem] card-anim border-white/5">
                        ${media}
                        <h3 class="text-2xl font-extrabold mb-4">${s.title}</h3>
                        <div class="relative group">
                            <pre class="bg-black/40 p-6 rounded-2xl text-[11px] text-purple-300 font-mono mb-6 overflow-x-auto max-h-60 border border-white/5"><code>${s.code}</code></pre>
                            <button onclick="copyCode(this, \`${s.code.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\` )" class="absolute top-4 right-4 bg-purple-600 p-2 rounded-xl opacity-0 group-hover:opacity-100 transition shadow-lg">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            </button>
                        </div>
                        <div class="flex justify-between items-center text-xs text-gray-500 uppercase tracking-widest">
                            <span>Morix Verified</span>
                            <span>${s.date}</span>
                        </div>
                    </div>
                `;
            });
        }

        function copyCode(btn, text) {
            navigator.clipboard.writeText(text);
            btn.innerHTML = '‚úÖ'; setTimeout(() => btn.innerHTML = 'üìÇ', 2000);
        }

        document.getElementById('searchInput').oninput = (e) => loadPosts(e.target.value);
    </script>
</body>
</html>
